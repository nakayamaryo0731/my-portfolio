---
export const prerender = true;

import { getCollection } from "astro:content";
import BasicLayout from "../../layouts/BasicLayout.astro";
import { formatDateJP } from "../../lib/helpers";

const posts = (await getCollection("blog", ({ data }) => !data.draft))
  .sort((a, b) => b.data.pubDate.getTime() - a.data.pubDate.getTime());

// Get unique tags
const allTags = [...new Set(posts.flatMap((post) => post.data.tags || []))];
---

<BasicLayout title="Blog - Ryo Nakayama" description="Blog posts by Ryo Nakayama">
  <main class="text-white m-auto px-6 py-12 max-w-3xl min-h-screen">
    <a href="/" class="text-sm text-gray-400 hover:text-white mb-4 inline-block">
      ‚Üê Back to Home
    </a>

    <h1 class="text-3xl font-bold mt-6 mb-8">Blog</h1>

    {allTags.length > 0 && (
      <div class="mb-8">
        <div class="flex flex-wrap gap-2">
          {allTags.map((tag) => (
            <a
              href={`/blog/tags/${tag}`}
              class="text-xs px-2 py-1 rounded bg-neutral-800 text-neutral-300 hover:bg-neutral-700 transition-colors"
            >
              #{tag}
            </a>
          ))}
        </div>
      </div>
    )}

    <ul class="space-y-4">
      {posts.map((post) => (
        <li class="border-b border-neutral-700 pb-4">
          <a href={`/blog/${post.id}`} class="group">
            <h2 class="text-xl font-medium group-hover:text-primary-400 transition-colors">
              {post.data.title}
            </h2>
            {post.data.description && (
              <p class="text-gray-400 text-sm mt-1 line-clamp-2">{post.data.description}</p>
            )}
            <div class="flex items-center gap-3 mt-2">
              <time class="text-xs text-gray-500">{formatDateJP(post.data.pubDate)}</time>
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="flex gap-1">
                  {post.data.tags.map((tag) => (
                    <span class="text-xs text-primary-400">#{tag}</span>
                  ))}
                </div>
              )}
            </div>
          </a>
        </li>
      ))}
    </ul>

    {posts.length === 0 && (
      <p class="text-gray-500">No posts yet.</p>
    )}
  </main>
</BasicLayout>

<style>
  body {
    justify-content: flex-start !important;
    height: auto !important;
    min-height: 100vh;
  }
</style>
